doctype html
html
  head
    title Chatroom
    | &#x9;&#x9;
    link(rel='stylesheet', type='text/css', href='stylesheets/chat.css')
    | &#x9;&#x9;
    script(type='text/javascript', src='javascripts/jquery-2.1.4.min.js')
    | &#x9;&#x9;
    script(type='text/javascript', src='https://cdn.socket.io/socket.io-1.2.0.js')
    | &#x9;&#x9;
    script(type='text/javascript').
      
      $(function() {
        $("#messageDiv input").keypress(function(event) {       
          if (event.keyCode == 13) getValue();
        });
      });

      var socket = io();

      function getuserid() {
      
        var url = location.href;
        var userid = url.split("?");

        return userid[1];
      }

      function printhello(){

        var user=getuserid();
        var hello = document.getElementById("hellouser");

        if (user != ""){
          hello.innerHTML = "Hello, "+user;
          $.post("/message", {note:  "[ "+user+" join chatroom ]" }); 
        } 
      }

      function historyMsg() {
        $.getJSON("/message", function(data) {
          console.log(data);
          
          $.each(data, function(key, val) {
            console.log(val);
            $('#outputData').append($('<li class="history">').text(val.note));
          });
        });
        printhello();
      }


      function newMsg() {
          var message = getuserid();
          message+= " : " + document.getElementById('inputarea').value ;
          socket.emit('chat message', message);
            
          $('#inputarea').val('');
          $.post("/message", {note: message});
        return false;
      }

      socket.on('chat message', function(msg){
        $('#outputData').append($('<li>').text(msg));
      });

      
  | &#x9;
  body(align='center' onload="historyMsg()")
 
    h5#hellouser You haven't login
    | &#x9;&#x9;
    span
      
    | &#x9;&#x9;&#x9;
    div#messageDiv()
      ul#outputData()
      | &#x9;&#x9;&#x9;&#x9;
      input#inputarea(type='text')
      | &#x9;&#x9;&#x9;&#x9;
      br
      | &#x9;&#x9;&#x9;&#x9;
      button#msgBtn(onclick='newMsg()') Submit!



<html>
<head>
	<title>Chatting</title>
	<script type="text/javascript">	

	function getuserid () {
	    
	    var url = location.href;
	    var userid = url.split("?");

	    return userid[1];
	}

	function printhello(){

   		var user=getuserid();
   		var hello = document.getElementById("hellouser");

   		if (user != ""){
	    	hello.innerHTML = "Hello, "+user;

	  		socket.emit('chat message', "[ "+user+" join chatroom ]");
	  		socket.emit('history message', "");
        
        
			}

		
	}

	
	</script>
</head>



<body onload="printhello()" align="center">

<H5 id="hellouser">You haven't login</H5>


	

<div id="mydiv" style="height:80%;width:800px;overflow:scroll;border:solid;margin: 0px auto;"   >
	<ul id="messages" align="left"></ul>
</div>

    <form action="" >
      <input id="m" autocomplete="off" /><button>Send</button>
    </form>


    
    <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <script>
      var socket = io();	

    $('form').submit(function(){
        socket.emit('chat message', getuserid()+":"+$('#m').val());
        
    	$('#m').val('');
        return false;
    });
    
     socket.on('chat message', function(msg){
      	$('#messages').append($('<ol>').text(msg))
    	$("#mydiv").scrollTop($("#mydiv")[0].scrollHeight)
      });



    socket.on('history message',function(his){
    	// jQuery.each( his, function( i, val ) {
    	for(var index in his) {
    	$('#messages').append($('<ol>').text(his[index].message));
    	}
    	// $("#mydiv").scrollTop($("#mydiv")[0].scrollHeight)
    });


    

    </script>


	
</body>
</html>